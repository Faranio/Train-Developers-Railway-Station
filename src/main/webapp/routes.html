<html>
<head>
    <meta charset="UTF-8">
    <title>TrainDevelopers | Main page</title>
    <link rel = "stylesheet" href = "startPageStyle.css">
    <link rel = "icon" href = "https://library.kissclipart.com/20180830/abq/kissclipart-train-clipart-train-rail-transport-rapid-transit-c4c301d377f15d73.png">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <title>Simple OSM GPX Track</title>

    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>

    <script src="https://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>

    <script type="text/javascript">

        var map; //complex object of type OpenLayers.Map
        var route;
        function drawRoute(str){
            route = new OpenLayers.Layer.Vector("Astana Almaty Route", {
                strategies: [new OpenLayers.Strategy.Fixed()],
                protocol: new OpenLayers.Protocol.HTTP({
                    url: ""+str+"",
                    format: new OpenLayers.Format.GPX()
                }),
                style: {strokeColor: "green", strokeWidth: 5, strokeOpacity: 0.5},
                projection: new OpenLayers.Projection("EPSG:4326")
            });
            map.addLayer(route);
        }

        function update(items) {
            items.forEach(function (e) {
                $("#routes-table").append("<tr align=\"center\"><td>" + e[0] + "</td><td>" + e[1] + "</td><td>" + e[2] + "</td><td>" + e[3] + "</td><td>" + e[4] + "</td><td>" + e[5] + "</td><td>" + e[6] + "</td><td>" + e[7] + "</td><td>" + e[8] + "</td></tr>");

                });
            $("#routes-table tr").on('click', function () {

                var from = $(this).find("td").eq(7).html();
                var to = $(this).find("td").eq(8).html();

                //alert('from ' + from + 'to' + to)
                String: routeName = from + "-" + to + ".gpx";
                if (route) {
                    window.map.removeLayer(route);
                }
                drawRoute(routeName)
            });
        }

        function getRoutes() {
            $.ajax({
                url : 'services/routes',
                dataType : 'json',
                success : function(r) {
                    update(r);
                }
            });
        }

        function init() {
            map = new OpenLayers.Map ("map", {
                controls:[
                    new OpenLayers.Control.Navigation({mouseWheelOptions: {interval: 500}}),
                    new OpenLayers.Control.PanZoomBar(),
                    new OpenLayers.Control.LayerSwitcher(),
                    new OpenLayers.Control.Attribution()],
                maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
                maxResolution: 156543.0399,
                numZoomLevels: 19,
                units: 'm',
                projection: new OpenLayers.Projection("EPSG:900913"),
                displayProjection: new OpenLayers.Projection("EPSG:4326")
            } );

            // Define the map layer
            // Here we use a predefined layer that will be kept up to date with URL changes
            layerMapnik = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
            map.addLayer(layerMapnik);
            layerCycleMap = new OpenLayers.Layer.OSM.CycleMap("CycleMap");
            map.addLayer(layerCycleMap);
            layerMarkers = new OpenLayers.Layer.Markers("Markers");
            map.addLayer(layerMarkers);
            //getRoutes();

            // Add a Layer with Marker
            var size = new OpenLayers.Size(21, 25);
            var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
            var icon = new OpenLayers.Icon('https://www.openstreetmap.org/openlayers/img/marker.png',size,offset);
            layerMarkers.addMarker(new OpenLayers.Marker(lonLat,icon));

            // Start position for the map (hardcoded here for simplicity,
            // but maybe you want to get this from the URL params)
            var lat=48.1742;
            var lon=68.449074;
            var zoom=5;
            var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
            map.setCenter(lonLat, zoom);

        }
        $(document).ready(function () {
            getRoutes();
            init();

        });

    </script>

</head>
<body>
<div>
    <h2>Routes</h2>
    <table id="routes-table">
        <tr>
            <th>RouteID</th>
            <th>DateFrom</th>
            <th>DateTo</th>
            <th>TimeFrom</th>
            <th>TimeTo</th>
            <th>Distance (in km)</th>
            <th>Status</th>
            <th>StationFrom</th>
            <th>StationTo</th>
        </tr>
    </table>
</div>
<div style="width:80%; height:90%" id="map"></div>

</body>
</html>
