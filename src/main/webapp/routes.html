<html>
<head>
    <meta charset="UTF-8">
    <title>TrainDevelopers | Main page</title>
    <link rel = "stylesheet" href = "startPageStyle.css">
    <link rel = "icon" href = "https://library.kissclipart.com/20180830/abq/kissclipart-train-clipart-train-rail-transport-rapid-transit-c4c301d377f15d73.png">
    <script src="scripts/jquery.min.js"></script>

    <title>Simple OSM GPX Track</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.0.1/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.0.1/build/ol.js"></script>
    
    <script type="text/javascript">
        var map; //complex object of type OpenLayers.Map
        var route;
        function drawRoute(str){
            route = new ol.layer.Vector({
                title: 'added Layer',
                source: new ol.source.Vector({
                    projection: 'EPSG:3857',
                    url: "" + str + "",
                    format: new ol.format.GeoJSON()
                }),
                style: new ol.style.Style({

                    stroke: new ol.style.Stroke({
                        color: "green",
                        width: 5
                    })
                })
            });
            map.addLayer(route);
        }

        function update(items) {
        	
        	$("#routes-table").find("tr:gt(0)").remove();
        	
            items.forEach(function (e) {
            	
            	if ($("#stationFrom").val() == e[7] && ($("#stationTo").val() == e[8]) && ($("#dateFrom").val() <= e[1]) && ($("#dateTo").val() >= e[1])){
                    
            		$("#routes-table").append("<tr align=\"center\"><td>" + e[0] + "</td><td>" + e[1] + "</td><td>" + e[2] + "</td><td>" + e[3] + "</td><td>" + e[4] + "</td><td>" + e[5] + "</td><td>" + e[6] + "</td><td>" + e[7] + "</td><td>" + e[8] + "</td></tr>");
                	}
                });
            $("#routes-table tr").on('click', function () {

                var from = $(this).find("td").eq(7).html();
                var to = $(this).find("td").eq(8).html();

                //alert('from ' + from + 'to' + to)
                String: routeName = "geojson/" + from + "-" + to + ".geojson";
                if (route) {
                    window.map.removeLayer(route);
                }
                drawRoute(routeName)
            });
        }

        function getRoutes() {
            $.ajax({
                url : 'services/routes',
                dataType : 'json',
                success : function(r) {
                    update(r);
                }
            });
        }

        function init() {
            map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM()
                    })
                ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([66.9237, 48.0196]),
                    zoom: 5
                })
            });
        }
        
        $(document).ready(function () {
        	
            init();
            
            $("#find-routes").on("click", function() {
                getRoutes();
            });
        });

    </script>

</head>
<body>
<div>
    <h2>Routes</h2>
    <br>
	<a href="index.html">Main Page</a>
	<br><br><br>
    <table id="routes-table">
        <tr>
            <th>RouteID</th>
            <th>DateFrom</th>
            <th>DateTo</th>
            <th>TimeFrom</th>
            <th>TimeTo</th>
            <th>Distance (in km)</th>
            <th>Status</th>
            <th>StationFrom</th>
            <th>StationTo</th>
        </tr>
    </table>
</div>
<select id="stationFrom">
    <option value="AST">Astana</option>
    <option value="ALM">Almaty</option>
    <option value="SEM">Semey</option>
    <option value="ATB">Aktobe</option>
    <option value="PET">Petropavlovsk</option>
    <option value="KSH">Kokshetau</option>
</select>

<select id="stationTo">
    <option value="AST">Astana</option>
    <option value="ALM">Almaty</option>
    <option value="SEM">Semey</option>
    <option value="ATB">Aktobe</option>
    <option value="PET">Petropavlovsk</option>
    <option value="KSH">Kokshetau</option>
</select>
<br>
<label for="dateFrom">Departure Date from</label>
<input type="date" id="dateFrom" required>
<br>
<label for="dateTo">Departure Date to</label>
<input type="date" id="dateTo" required>
<br>
<button id="find-routes"> Find Routes</button>
<br><br><br>
<div style="width:80%; height:90%" id="map"></div>

</body>
</html>
