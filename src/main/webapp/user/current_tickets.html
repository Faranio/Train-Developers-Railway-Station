<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TrainDevelopers | Main page</title>
    <link rel = "stylesheet" type="text/css" href = "../css/base.css">
    <link rel = "icon" href = "https://library.kissclipart.com/20180830/abq/kissclipart-train-clipart-train-rail-transport-rapid-transit-c4c301d377f15d73.png">
    <script src="../scripts/jquery.min.js"></script>
    <script type="text/javascript">

        function getTickets() {
            $.get('../services/tickets', {}, function(r) {
                showTickets(r);
            }, 'json');
        }



        function showTickets(items) {

            $("#ticket-table").find("tr:gt(0)").remove();

            items.forEach(function (e) {
                curentOrderID = e[1];
                curentTicketID = e[0];
                var ticketDate = new Date(e[3]);
                var today = new Date();
                if (ticketDate > today){
                    $("#ticket-table").append("<tr align=\"center\"><td>" + e[0] + "</td><td>" + e[1] + "</td><td>" + e[2] + "</td><td>" + e[3] + "</td><td>" + e[4] + "</td><td>" + e[5] + "</td><td>" + e[6] + "</td><td>" + e[7] + "</td><td>" + e[8] + "</td><td>" + e[9] + "</td><td>" + e[10] + "</td><td>" + e[11] + "</td><td>" + e[12] + "</td><td>" + e[13] + "</td><td><button> Edit </button class = \"edit-t\"></td ><td><button class = \"cancel-t\"> Cancel </button></td></tr>");
                }
            });

            $("#ticket-table tr > td:eq(14) > button").on('click', function () {
                orderID = $(this).closest('tr').find("td").eq(1).html();
                ticketID = $(this).closest('tr').find("td").eq(0).html();
                IDs = [orderID, ticketID];
                console.log(IDs);
                localStorage.setItem("IDs", JSON.stringify(IDs));
                window.location.href = 'ticket_editing.html';
            });

            $("#ticket-table tr > td:eq(15) > button").on('click', function () {
                orderID = $(this).closest('tr').find("td").eq(1).html();
                ticketID = $(this).closest('tr').find("td").eq(0).html();
                confirmCancelling = confirm("Are you sure?");
                if (confirmCancelling == true){
                    cancel();
                }
            });

        }

        function cancel(){
            $.post("../services/cancel", {OrderID : orderID, TicketID: ticketID}, function(r) {
                console.log("success" + r + " cancel");
            }).fail(function(r) {
                console.log("fail" + r.responseText + " cancel");
            });
        }

        $(document).ready(function () {
            getTickets();
        });

    </script>
</head>
<body>
<div class="header">
    <div><img src="../css/main_logo.jpg" height="65px"/></div>
    <div><h2>TRAIN DEVELOPERS</h2></div>
    <div><a href="../index.html">Main Page</a></div>
</div>
<h2>Current Tickets</h2>
<br>
<a href="regular_profile.html">Back to Profile Page</a>
<br>
<div>
    <h2>Tickets</h2>
    <table id="ticket-table">
        <tr>
            <th>Ticket ID</th>
            <th>Order ID</th>
            <th>From</th>
            <th>Departure Date</th>
            <th>Departure Time</th>
            <th>To</th>
            <th>Arrival Date</th>
            <th>Arrival Time</th>
            <th>Price</th>
            <th>Train ID</th>
            <th>Carriage Number</th>
            <th>Seat Number</th>
            <th>Document ID</th>
            <th>Name</th>
            <th></th>
            <th></th>
        </tr>
    </table>
</div>

<div class="contact">
    <h3>CONTACT US</h3>
    <div class="contactUs">
        <div><p>email: support@train.kz</p></div>
        <div><p>telephone: +77777777777</p></div>
        <div><p>telephone: +77777777778</p></div>
    </div>
</div>

</body>
</html>
